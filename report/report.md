./profiler.sh -d 80 -e lock -f hw2lock_get.html 712  
./profiler.sh -d 80 -e lock -f hw2alloc_get.html 712  
./profiler.sh -d 80 -e lock -f hw2cpu_get.html 712

wrk -c 64 -t 3 -d 1m -R 10000 -L -s get.lua http://localhost:8080


wrk -c 64 -t 3 -d 4m -R 20000 -L -s put.lua http://localhost:8080  
root@DESKTOP-E01FUOQ:~/wrk2# wrk -c 64 -t 3 -d 4m -R 20000 -L -s put.lua http://localhost:8080

Running 4m test @ http://localhost:8080  
3 threads and 64 connections  
Thread calibration: mean lat.: 1.623ms, rate sampling interval: 10ms  
Thread calibration: mean lat.: 1.663ms, rate sampling interval: 10ms  
Thread calibration: mean lat.: 1.619ms, rate sampling interval: 10ms  
Thread Stats   Avg      Stdev     Max   +/- Stdev  
Latency     1.49ms    2.60ms 126.78ms   96.61%  
Req/Sec     7.04k     1.09k   39.67k    89.72%  
Latency Distribution (HdrHistogram - Recorded Latency)  
50.000%    1.16ms  
75.000%    1.62ms  
90.000%    2.16ms  
99.000%    8.94ms  
99.900%   33.31ms  
99.990%   98.11ms  
99.999%  120.96ms  
100.000%  126.85ms  

Detailed Percentile spectrum:  
Value   Percentile   TotalCount 1/(1-Percentile)  

       0.034     0.000000            1         1.00
       0.485     0.100000       460249         1.11
       0.668     0.200000       920379         1.25
       0.833     0.300000      1381535         1.43
       0.993     0.400000      1839492         1.67
       1.159     0.500000      2300475         2.00
       1.245     0.550000      2530797         2.22
       1.332     0.600000      2759120         2.50
       1.422     0.650000      2989288         2.86
       1.515     0.700000      3219259         3.33
       1.616     0.750000      3450008         4.00
       1.672     0.775000      3565215         4.44
       1.734     0.800000      3679980         5.00
       1.805     0.825000      3794516         5.71
       1.891     0.850000      3909322         6.67
       2.002     0.875000      4024048         8.00
       2.073     0.887500      4081821         8.89
       2.159     0.900000      4138643        10.00
       2.271     0.912500      4196171        11.43
       2.431     0.925000      4253614        13.33
       2.679     0.937500      4310832        16.00
       2.861     0.943750      4339436        17.78
       3.099     0.950000      4368139        20.00
       3.409     0.956250      4396798        22.86
       3.807     0.962500      4425596        26.67
       4.343     0.968750      4454387        32.00
       4.679     0.971875      4468743        35.56
       5.075     0.975000      4483086        40.00
       5.547     0.978125      4497369        45.71
       6.135     0.981250      4511730        53.33
       6.887     0.984375      4526143        64.00
       7.339     0.985938      4533327        71.11
       7.871     0.987500      4540445        80.00
       8.503     0.989062      4547641        91.43
       9.239     0.990625      4554823       106.67
      10.151     0.992188      4562009       128.00
      10.695     0.992969      4565594       142.22
      11.319     0.993750      4569183       160.00
      12.079     0.994531      4572808       182.86
      12.999     0.995313      4576371       213.33
      14.271     0.996094      4579971       256.00
      15.039     0.996484      4581753       284.44
      15.967     0.996875      4583551       320.00
      17.119     0.997266      4585348       365.71
      18.623     0.997656      4587145       426.67
      20.735     0.998047      4588941       512.00
      22.143     0.998242      4589843       568.89
      23.871     0.998437      4590737       640.00
      26.303     0.998633      4591631       731.43
      29.343     0.998828      4592531       853.33
      33.887     0.999023      4593428      1024.00
      37.119     0.999121      4593878      1137.78
      41.183     0.999219      4594326      1280.00
      45.983     0.999316      4594775      1462.86
      51.135     0.999414      4595227      1706.67
      56.959     0.999512      4595672      2048.00
      60.735     0.999561      4595898      2275.56
      64.735     0.999609      4596121      2560.00
      68.863     0.999658      4596350      2925.71
      72.575     0.999707      4596572      3413.33
      76.991     0.999756      4596798      4096.00
      80.447     0.999780      4596911      4551.11
      83.903     0.999805      4597019      5120.00
      87.167     0.999829      4597133      5851.43
      90.623     0.999854      4597244      6826.67
      94.143     0.999878      4597357      8192.00
      96.191     0.999890      4597412      9102.22
      98.559     0.999902      4597468     10240.00
     100.671     0.999915      4597525     11702.86
     102.783     0.999927      4597582     13653.33
     105.471     0.999939      4597637     16384.00
     107.135     0.999945      4597665     18204.44
     108.799     0.999951      4597693     20480.00
     110.015     0.999957      4597721     23405.71
     111.423     0.999963      4597749     27306.67
     112.831     0.999969      4597777     32768.00
     113.855     0.999973      4597791     36408.89
     115.007     0.999976      4597805     40960.00
     116.351     0.999979      4597820     46811.43
     117.567     0.999982      4597833     54613.33
     118.783     0.999985      4597847     65536.00
     119.615     0.999986      4597854     72817.78
     120.063     0.999988      4597861     81920.00
     120.895     0.999989      4597870     93622.86
     121.407     0.999991      4597875    109226.67
     121.983     0.999992      4597882    131072.00
     122.623     0.999993      4597886    145635.56
     122.687     0.999994      4597889    163840.00
     123.135     0.999995      4597894    187245.71
     123.263     0.999995      4597896    218453.33
     123.711     0.999996      4597900    262144.00
     123.903     0.999997      4597902    291271.11
     124.095     0.999997      4597903    327680.00
     124.415     0.999997      4597905    374491.43
     124.607     0.999998      4597907    436906.67
     125.183     0.999998      4597909    524288.00
     125.247     0.999998      4597911    582542.22
     125.247     0.999998      4597911    655360.00
     125.247     0.999999      4597911    748982.86
     125.375     0.999999      4597913    873813.33
     125.375     0.999999      4597913   1048576.00
     125.439     0.999999      4597914   1165084.44
     125.439     0.999999      4597914   1310720.00
     125.439     0.999999      4597914   1497965.71
     125.759     0.999999      4597915   1747626.67
     125.759     1.000000      4597915   2097152.00
     125.823     1.000000      4597916   2330168.89
     125.823     1.000000      4597916   2621440.00
     125.823     1.000000      4597916   2995931.43
     125.823     1.000000      4597916   3495253.33
     125.823     1.000000      4597916   4194304.00
     126.847     1.000000      4597917   4660337.78
     126.847     1.000000      4597917          inf
[Mean    =        1.495, StdDeviation   =        2.600]  
[Max     =      126.784, Total count    =      4597917]  
[Buckets =           27, SubBuckets     =         2048]  
----------------------------------------------------------  
4799003 requests in 4.00m, 306.64MB read  
Requests/sec:  19995.84  
Transfer/sec:      1.28MB  

----


root@DESKTOP-E01FUOQ:~/async-profiler# ./profiler.sh -d 80 -f hw2cpu_get.html 4307  
root@DESKTOP-E01FUOQ:~/async-profiler# ./profiler.sh -d 80 -e alloc -f hw2alloc_get.html 4307  
root@DESKTOP-E01FUOQ:~/async-profiler# ./profiler.sh -d 80 -e lock -f hw2lock_get.html 4307  

#GET

По наполненной базе

wrk -c 64 -t 3 -d 5m -R 20000 -L -s get.lua http://localhost:8080  
Running 5m test @ http://localhost:8080  
3 threads and 64 connections  
Thread calibration: mean lat.: 1.652ms, rate sampling interval: 10ms  
Thread calibration: mean lat.: 1.616ms, rate sampling interval: 10ms  
Thread calibration: mean lat.: 1.614ms, rate sampling interval: 10ms  
Thread Stats   Avg      Stdev     Max   +/- Stdev  
Latency     1.66ms    1.86ms  57.31ms   93.07%  
Req/Sec     7.05k     1.25k   29.80k    86.43%  
Latency Distribution (HdrHistogram - Recorded Latency)  
50.000%    1.26ms  
75.000%    1.80ms  
90.000%    2.79ms  
99.000%    9.61ms  
99.900%   21.12ms  
99.990%   37.60ms  
99.999%   50.43ms  
100.000%   57.34ms  

Detailed Percentile spectrum:  
Value   Percentile   TotalCount 1/(1-Percentile)  

       0.038     0.000000            2         1.00
       0.527     0.100000       581949         1.11
       0.723     0.200000      1159920         1.25
       0.900     0.300000      1740529         1.43
       1.075     0.400000      2319255         1.67
       1.258     0.500000      2901534         2.00
       1.353     0.550000      3191419         2.22
       1.451     0.600000      3481492         2.50
       1.553     0.650000      3769242         2.86
       1.666     0.700000      4058844         3.33
       1.799     0.750000      4348740         4.00
       1.879     0.775000      4494953         4.44
       1.973     0.800000      4638823         5.00
       2.089     0.825000      4784142         5.71
       2.239     0.850000      4929100         6.67
       2.451     0.875000      5073256         8.00
       2.599     0.887500      5146233         8.89
       2.785     0.900000      5218368        10.00
       3.029     0.912500      5290861        11.43
       3.343     0.925000      5363095        13.33
       3.767     0.937500      5435533        16.00
       4.031     0.943750      5471857        17.78
       4.339     0.950000      5508030        20.00
       4.707     0.956250      5544266        22.86
       5.143     0.962500      5580621        26.67
       5.683     0.968750      5616878        32.00
       6.003     0.971875      5634819        35.56
       6.371     0.975000      5652982        40.00
       6.803     0.978125      5671114        45.71
       7.315     0.981250      5689273        53.33
       7.947     0.984375      5707334        64.00
       8.327     0.985938      5716366        71.11
       8.767     0.987500      5725453        80.00
       9.263     0.989062      5734469        91.43
       9.863     0.990625      5743565       106.67
      10.607     0.992188      5752657       128.00
      11.031     0.992969      5757131       142.22
      11.511     0.993750      5761668       160.00
      12.071     0.994531      5766203       182.86
      12.743     0.995313      5770707       213.33
      13.575     0.996094      5775225       256.00
      14.071     0.996484      5777496       284.44
      14.631     0.996875      5779756       320.00
      15.303     0.997266      5782025       365.71
      16.103     0.997656      5784291       426.67
      17.071     0.998047      5786570       512.00
      17.663     0.998242      5787684       568.89
      18.367     0.998437      5788838       640.00
      19.183     0.998633      5789967       731.43
      20.127     0.998828      5791085       853.33
      21.263     0.999023      5792225      1024.00
      22.015     0.999121      5792788      1137.78
      22.767     0.999219      5793347      1280.00
      23.695     0.999316      5793918      1462.86
      24.847     0.999414      5794479      1706.67
      26.239     0.999512      5795043      2048.00
      27.039     0.999561      5795326      2275.56
      27.871     0.999609      5795610      2560.00
      28.943     0.999658      5795897      2925.71
      30.191     0.999707      5796174      3413.33
      31.615     0.999756      5796457      4096.00
      32.447     0.999780      5796602      4551.11
      33.247     0.999805      5796740      5120.00
      34.271     0.999829      5796886      5851.43
      35.295     0.999854      5797027      6826.67
      36.351     0.999878      5797170      8192.00
      37.055     0.999890      5797238      9102.22
      37.663     0.999902      5797306     10240.00
      38.431     0.999915      5797379     11702.86
      39.327     0.999927      5797448     13653.33
      40.415     0.999939      5797519     16384.00
      41.087     0.999945      5797554     18204.44
      41.791     0.999951      5797589     20480.00
      42.879     0.999957      5797625     23405.71
      43.711     0.999963      5797660     27306.67
      44.511     0.999969      5797696     32768.00
      45.503     0.999973      5797713     36408.89
      46.335     0.999976      5797732     40960.00
      47.167     0.999979      5797749     46811.43
      47.871     0.999982      5797766     54613.33
      48.703     0.999985      5797784     65536.00
      49.055     0.999986      5797793     72817.78
      49.599     0.999988      5797802     81920.00
      50.239     0.999989      5797811     93622.86
      50.623     0.999991      5797819    109226.67
      51.199     0.999992      5797828    131072.00
      51.487     0.999993      5797833    145635.56
      51.647     0.999994      5797838    163840.00
      51.775     0.999995      5797842    187245.71
      52.063     0.999995      5797846    218453.33
      52.479     0.999996      5797850    262144.00
      52.767     0.999997      5797853    291271.11
      53.151     0.999997      5797855    327680.00
      53.375     0.999997      5797857    374491.43
      53.759     0.999998      5797859    436906.67
      53.951     0.999998      5797862    524288.00
      54.367     0.999998      5797863    582542.22
      54.591     0.999998      5797865    655360.00
      54.591     0.999999      5797865    748982.86
      55.103     0.999999      5797866    873813.33
      55.551     0.999999      5797868   1048576.00
      55.551     0.999999      5797868   1165084.44
      55.551     0.999999      5797868   1310720.00
      55.967     0.999999      5797870   1497965.71
      55.967     0.999999      5797870   1747626.67
      55.967     1.000000      5797870   2097152.00
      55.967     1.000000      5797870   2330168.89
      55.967     1.000000      5797870   2621440.00
      56.511     1.000000      5797871   2995931.43
      56.511     1.000000      5797871   3495253.33
      56.511     1.000000      5797871   4194304.00
      56.511     1.000000      5797871   4660337.78
      56.511     1.000000      5797871   5242880.00
      57.343     1.000000      5797872   5991862.86
      57.343     1.000000      5797872          inf
[Mean    =        1.658, StdDeviation   =        1.861]  
[Max     =       57.312, Total count    =      5797872]  
[Buckets =           27, SubBuckets     =         2048]  
----------------------------------------------------------  
5998991 requests in 5.00m, 394.75MB read  
Requests/sec:  19996.63  
Transfer/sec:      1.32MB  

#ВЫВОДЫ:

[cpu_put](hw2cpu_put.html)
[alloc_put](hw2alloc_put.html)
[lock_put](hw2lock_put.html)

##Put:
Не получилось замерить(попробую пофиксить до лекции), на графике видно, что сразу вызываются системные вызовыю.
При первом обращении же к storage, все как будто локается, хотя concurrentSkipListMap. Так и не понял почему, попробую добить



[cpu_get](hw2cpu_get.html)
[alloc_get](hw2alloc_get.html)
[lock_get](hw2lock_get.html)
##Get:
этот гет, с прошлой недели, сейчас не могу решить так же как с cpu, просидев много времени с этим

После убирания synchronize с get, скорость увеличилась, локов больше нет. Основное время нахожднеия все так же в offset,
и в one-nio. Разница между 3мя и 4мя девятками, связана, вероятно, с GC, у которого 37 samples, т.к для 99.990% выполняется быстрее чем 11мс,
остальное может и уходит на GC, если смотреть на профиль, то с другим это и не связано.
По сравнению с первой работой, снизилось время нахождения в sendResponse one-nio, может, конечно повлияли замеры, т.к
там же ничего не было изменено.

Оптимизации: для гетов, все так же можно иметь какой-то кэш, с диапазонами, либо с самими ключами, что позволит не 
всегда ходить на диск.



