./profiler.sh -d 120 -e lock -f hw2lock_get.html 712  
wrk -c 64 -t 3 -d 1m -R 10000 -L -s get.lua http://localhost:8080


wrk -c 64 -t 3 -d 4m -R 10000 -L -s put.lua http://localhost:8080  
Running 4m test @ http://localhost:8080  
3 threads and 64 connections  
Thread calibration: mean lat.: 9223372036854776.000ms, rate sampling interval: 10ms  
Thread calibration: mean lat.: 9223372036854776.000ms, rate sampling interval: 10ms  
Thread calibration: mean lat.: 9223372036854776.000ms, rate sampling interval: 10ms  
Thread Stats   Avg      Stdev     Max   +/- Stdev  
Latency     -nanus    -nanus   0.00us    0.00%  
Req/Sec     0.00      0.00     0.00    100.00%  
Latency Distribution (HdrHistogram - Recorded Latency)  
50.000%    0.00us  
75.000%    0.00us  
90.000%    0.00us  
99.000%    0.00us  
99.900%    0.00us  
99.990%    0.00us  
99.999%    0.00us  
100.000%    0.00us  

Detailed Percentile spectrum:  
Value   Percentile   TotalCount 1/(1-Percentile)  

       0.000     1.000000            0          inf
[Mean    =         -nan, StdDeviation   =         -nan]  
[Max     =        0.000, Total count    =            0]  
[Buckets =           27, SubBuckets     =         2048]  
----------------------------------------------------------  
0 requests in 4.00m, 0.00B read  
Socket errors: connect 0, read 0, write 0, timeout 7559  
Requests/sec:      0.00  
Transfer/sec:       0.00B  



----

#GET

/wrk2# wrk -c 64 -t 3 -d 4m -R 10000 -L -s get.lua http://localhost:8080  
Running 4m test @ http://localhost:8080  
3 threads and 64 connections  
Thread calibration: mean lat.: 2.234ms, rate sampling interval: 10ms  
Thread calibration: mean lat.: 2.296ms, rate sampling interval: 10ms  
Thread calibration: mean lat.: 2.410ms, rate sampling interval: 10ms  
Thread Stats   Avg      Stdev     Max   +/- Stdev  
Latency     1.27ms  674.91us  23.84ms   73.41%  
Req/Sec     3.51k   317.41     7.33k    75.27%  
Latency Distribution (HdrHistogram - Recorded Latency)  
50.000%    1.19ms  
75.000%    1.65ms  
90.000%    2.04ms  
99.000%    3.26ms  
99.900%    6.07ms  
99.990%   11.32ms  
99.999%   17.53ms  
100.000%   23.85ms  

Detailed Percentile spectrum:  
Value   Percentile   TotalCount 1/(1-Percentile)  

       0.054     0.000000            1         1.00
       0.521     0.100000       230080         1.11
       0.700     0.200000       460958         1.25
       0.861     0.300000       689937         1.43
       1.022     0.400000       920213         1.67
       1.187     0.500000      1149869         2.00
       1.273     0.550000      1264756         2.22
       1.362     0.600000      1379653         2.50
       1.455     0.650000      1495463         2.86
       1.550     0.700000      1609346         3.33
       1.651     0.750000      1724360         4.00
       1.704     0.775000      1782376         4.44
       1.759     0.800000      1839842         5.00
       1.818     0.825000      1897276         5.71
       1.882     0.850000      1954313         6.67
       1.954     0.875000      2011774         8.00
       1.995     0.887500      2040682         8.89
       2.040     0.900000      2069308        10.00
       2.091     0.912500      2098348        11.43
       2.149     0.925000      2126778        13.33
       2.221     0.937500      2155919        16.00
       2.261     0.943750      2169785        17.78
       2.309     0.950000      2184442        20.00
       2.363     0.956250      2198392        22.86
       2.431     0.962500      2212907        26.67
       2.517     0.968750      2227315        32.00
       2.569     0.971875      2234370        35.56
       2.631     0.975000      2241630        40.00
       2.705     0.978125      2248702        45.71
       2.801     0.981250      2255939        53.33
       2.921     0.984375      2263078        64.00
       2.995     0.985938      2266624        71.11
       3.081     0.987500      2270286        80.00
       3.181     0.989062      2273833        91.43
       3.311     0.990625      2277415       106.67
       3.475     0.992188      2280998       128.00
       3.577     0.992969      2282792       142.22
       3.695     0.993750      2284612       160.00
       3.829     0.994531      2286399       182.86
       3.989     0.995313      2288189       213.33
       4.195     0.996094      2290002       256.00
       4.315     0.996484      2290893       284.44
       4.447     0.996875      2291779       320.00
       4.607     0.997266      2292685       365.71
       4.803     0.997656      2293575       426.67
       5.035     0.998047      2294470       512.00
       5.183     0.998242      2294920       568.89
       5.351     0.998437      2295365       640.00
       5.535     0.998633      2295811       731.43
       5.807     0.998828      2296265       853.33
       6.099     0.999023      2296711      1024.00
       6.291     0.999121      2296935      1137.78
       6.515     0.999219      2297158      1280.00
       6.747     0.999316      2297383      1462.86
       7.043     0.999414      2297606      1706.67
       7.363     0.999512      2297832      2048.00
       7.559     0.999561      2297943      2275.56
       7.807     0.999609      2298056      2560.00
       8.115     0.999658      2298170      2925.71
       8.439     0.999707      2298283      3413.33
       8.919     0.999756      2298392      4096.00
       9.191     0.999780      2298448      4551.11
       9.543     0.999805      2298506      5120.00
       9.855     0.999829      2298561      5851.43
      10.311     0.999854      2298617      6826.67
      10.863     0.999878      2298673      8192.00
      11.119     0.999890      2298701      9102.22
      11.367     0.999902      2298729     10240.00
      11.807     0.999915      2298757     11702.86
      12.287     0.999927      2298785     13653.33
      12.791     0.999939      2298814     16384.00
      13.007     0.999945      2298827     18204.44
      13.295     0.999951      2298842     20480.00
      13.615     0.999957      2298855     23405.71
      14.135     0.999963      2298869     27306.67
      14.399     0.999969      2298884     32768.00
      14.551     0.999973      2298890     36408.89
      14.903     0.999976      2298897     40960.00
      15.359     0.999979      2298904     46811.43
      15.919     0.999982      2298911     54613.33
      16.623     0.999985      2298919     65536.00
      16.815     0.999986      2298923     72817.78
      17.119     0.999988      2298925     81920.00
      17.487     0.999989      2298929     93622.86
      17.567     0.999991      2298932    109226.67
      17.775     0.999992      2298936    131072.00
      18.047     0.999993      2298938    145635.56
      18.223     0.999994      2298939    163840.00
      18.511     0.999995      2298941    187245.71
      18.639     0.999995      2298943    218453.33
      18.783     0.999996      2298945    262144.00
      18.975     0.999997      2298946    291271.11
      18.975     0.999997      2298946    327680.00
      19.567     0.999997      2298947    374491.43
      19.663     0.999998      2298948    436906.67
      20.127     0.999998      2298949    524288.00
      20.223     0.999998      2298950    582542.22
      20.223     0.999998      2298950    655360.00
      20.223     0.999999      2298950    748982.86
      20.879     0.999999      2298951    873813.33
      20.879     0.999999      2298951   1048576.00
      22.895     0.999999      2298952   1165084.44
      22.895     0.999999      2298952   1310720.00
      22.895     0.999999      2298952   1497965.71
      22.895     0.999999      2298952   1747626.67
      22.895     1.000000      2298952   2097152.00
      23.855     1.000000      2298953   2330168.89
      23.855     1.000000      2298953          inf
#[Mean    =        1.267, StdDeviation   =        0.675]
#[Max     =       23.840, Total count    =      2298953]
#[Buckets =           27, SubBuckets     =         2048]
----------------------------------------------------------
2399522 requests in 4.00m, 168.99MB read
Non-2xx or 3xx responses: 6
Requests/sec:   9997.97
Transfer/sec:    721.03KB

#ВЫВОДЫ:

[cpu_put](hw2cpu_put.html)
[alloc_put](hw2alloc_put.html)
[lock_put](hw2lock_put.html)

##Put:
Не получилось замерить(попробую пофиксить до лекции), на графике видно, что сразу вызываются системные вызовыю.
При первом обращении же к storage, все как будто локается, хотя concurrentSkipListMap. Так и не понял почему, попробую добить



[cpu_get](hw2cpu_get.html)
[alloc_get](hw2alloc_get.html)
[lock_get](hw2lock_get.html)
##Get:
этот гет, с прошлой недели, сейчас не могу решить так же как с cpu, просидев много времени с этим

После убирания synchronize с get, скорость увеличилась, локов больше нет. Основное время нахожднеия все так же в offset,
и в one-nio. Разница между 3мя и 4мя девятками, связана с GC, которого 37 samples.
По сравнению с первой работой, снизилось время нахождения в sendResponse one-nio, может, конечно повлияли замеры, т.к
там же ничего не было изменено.

Оптимизации: для гетов, все так же можно иметь какой-то кэш, с диапазонами, либо с самими ключами.



