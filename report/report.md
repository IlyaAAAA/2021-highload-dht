./profiler.sh -d 90 -e lock -f hw4lock_put.html 712  
./profiler.sh -d 90 -e alloc -f hw4alloc_put.html 712  
./profiler.sh -d 90 -f hw4cpu_put.html 712

wrk -c 64 -t 3 -d 1m -R 10000 -L -s get.lua http://localhost:8080

root@DESKTOP-E01FUOQ:~/wrk2# wrk -c 120 -t 3 -d 2m -R 20000 -L -s put.lua http://localhost:8080  
Running 2m test @ http://localhost:8080  
3 threads and 120 connections  
Thread calibration: mean lat.: 2.648ms, rate sampling interval: 10ms  
Thread calibration: mean lat.: 3.948ms, rate sampling interval: 12ms  
Thread calibration: mean lat.: 3.901ms, rate sampling interval: 12ms  
Thread Stats   Avg      Stdev     Max   +/- Stdev  
Latency     2.24ms    2.71ms  32.83ms   89.94%  
Req/Sec     7.02k     1.55k   20.44k    83.35%  
Latency Distribution (HdrHistogram - Recorded Latency)  
50.000%    1.42ms  
75.000%    2.12ms  
90.000%    4.99ms  
99.000%   14.14ms  
99.900%   19.71ms  
99.990%   24.25ms  
99.999%   29.23ms  
100.000%   32.86ms  

Detailed Percentile spectrum:  
Value   Percentile   TotalCount 1/(1-Percentile)  

       0.061     0.000000            1         1.00
       0.572     0.100000       220395         1.11
       0.791     0.200000       439278         1.25
       0.996     0.300000       659648         1.43
       1.199     0.400000       879396         1.67
       1.416     0.500000      1098397         2.00
       1.532     0.550000      1208656         2.22
       1.651     0.600000      1318005         2.50
       1.779     0.650000      1427965         2.86
       1.926     0.700000      1537318         3.33
       2.115     0.750000      1647830         4.00
       2.237     0.775000      1702609         4.44
       2.397     0.800000      1757262         5.00
       2.635     0.825000      1811948         5.71
       3.081     0.850000      1866784         6.67
       3.845     0.875000      1921578         8.00
       4.371     0.887500      1949118         8.89
       4.987     0.900000      1976547        10.00
       5.703     0.912500      2003882        11.43
       6.507     0.925000      2031379        13.33
       7.419     0.937500      2058848        16.00
       7.919     0.943750      2072580        17.78
       8.463     0.950000      2086384        20.00
       9.047     0.956250      2099978        22.86
       9.687     0.962500      2113805        26.67
      10.399     0.968750      2127461        32.00
      10.807     0.971875      2134389        35.56
      11.231     0.975000      2141130        40.00
      11.695     0.978125      2148008        45.71
      12.215     0.981250      2154916        53.33
      12.799     0.984375      2161757        64.00
      13.119     0.985938      2165149        71.11
      13.479     0.987500      2168597        80.00
      13.871     0.989062      2172017        91.43
      14.311     0.990625      2175433       106.67
      14.823     0.992188      2178866       128.00
      15.119     0.992969      2180594       142.22
      15.423     0.993750      2182329       160.00
      15.775     0.994531      2184032       182.86
      16.175     0.995313      2185745       213.33
      16.639     0.996094      2187493       256.00
      16.895     0.996484      2188337       284.44
      17.183     0.996875      2189191       320.00
      17.503     0.997266      2190040       365.71
      17.855     0.997656      2190908       426.67
      18.255     0.998047      2191747       512.00
      18.511     0.998242      2192176       568.89
      18.767     0.998437      2192598       640.00
      19.055     0.998633      2193026       731.43
      19.375     0.998828      2193456       853.33
      19.775     0.999023      2193883      1024.00
      19.999     0.999121      2194100      1137.78
      20.223     0.999219      2194306      1280.00
      20.511     0.999316      2194536      1462.86
      20.831     0.999414      2194745      1706.67
      21.167     0.999512      2194952      2048.00
      21.391     0.999561      2195064      2275.56
      21.599     0.999609      2195163      2560.00
      21.871     0.999658      2195270      2925.71
      22.159     0.999707      2195383      3413.33
      22.527     0.999756      2195486      4096.00
      22.735     0.999780      2195542      4551.11
      22.943     0.999805      2195597      5120.00
      23.231     0.999829      2195645      5851.43
      23.455     0.999854      2195701      6826.67
      23.871     0.999878      2195753      8192.00
      24.079     0.999890      2195781      9102.22
      24.319     0.999902      2195806     10240.00
      24.639     0.999915      2195834     11702.86
      24.991     0.999927      2195861     13653.33
      25.311     0.999939      2195887     16384.00
      25.503     0.999945      2195900     18204.44
      25.791     0.999951      2195913     20480.00
      26.095     0.999957      2195927     23405.71
      26.495     0.999963      2195940     27306.67
      26.687     0.999969      2195953     32768.00
      26.911     0.999973      2195960     36408.89
      27.103     0.999976      2195967     40960.00
      27.311     0.999979      2195974     46811.43
      27.455     0.999982      2195980     54613.33
      28.063     0.999985      2195987     65536.00
      28.143     0.999986      2195990     72817.78
      28.591     0.999988      2195994     81920.00
      29.023     0.999989      2195997     93622.86
      29.279     0.999991      2196000    109226.67
      29.679     0.999992      2196004    131072.00
      29.759     0.999993      2196005    145635.56
      29.839     0.999994      2196007    163840.00
      30.031     0.999995      2196009    187245.71
      30.047     0.999995      2196010    218453.33
      30.239     0.999996      2196012    262144.00
      30.383     0.999997      2196013    291271.11
      30.495     0.999997      2196014    327680.00
      30.543     0.999997      2196015    374491.43
      30.543     0.999998      2196015    436906.67
      30.751     0.999998      2196016    524288.00
      30.863     0.999998      2196017    582542.22
      30.863     0.999998      2196017    655360.00
      31.359     0.999999      2196018    748982.86
      31.359     0.999999      2196018    873813.33
      31.359     0.999999      2196018   1048576.00
      31.903     0.999999      2196019   1165084.44
      31.903     0.999999      2196019   1310720.00
      31.903     0.999999      2196019   1497965.71
      31.903     0.999999      2196019   1747626.67
      31.903     1.000000      2196019   2097152.00
      32.863     1.000000      2196020   2330168.89
      32.863     1.000000      2196020          inf
[Mean    =        2.240, StdDeviation   =        2.709]   
[Max     =       32.832, Total count    =      2196020]   
[Buckets =           27, SubBuckets     =         2048]   
----------------------------------------------------------
2398086 requests in 2.00m, 200.40MB read  
Requests/sec:  19983.88  
Transfer/sec:      1.67MB  

----


./profiler.sh -d 90 -e lock -f hw4lock_get.html 712  
./profiler.sh -d 90 -e alloc -f hw4alloc_get.html 712    
./profiler.sh -d 90 -f hw4cpu_get.html 712  

# GET

По наполненной базе

root@DESKTOP-E01FUOQ:~/wrk2# wrk -c 120 -t 3 -d 2m -R 20000 -L -s get.lua http://localhost:8080  
Running 2m test @ http://localhost:8080  
3 threads and 120 connections  
Thread calibration: mean lat.: 2.645ms, rate sampling interval: 10ms  
Thread calibration: mean lat.: 2.546ms, rate sampling interval: 10ms  
Thread calibration: mean lat.: 2.546ms, rate sampling interval: 10ms   
Thread Stats   Avg      Stdev     Max   +/- Stdev  
Latency     2.18ms    3.93ms 108.42ms   94.16%  
Req/Sec     7.06k     1.36k   20.11k    85.42%  
Latency Distribution (HdrHistogram - Recorded Latency)  
50.000%    1.40ms  
75.000%    2.06ms  
90.000%    3.66ms  
99.000%   13.97ms  
99.900%   62.01ms  
99.990%   91.39ms  
99.999%  102.85ms  
100.000%  108.48ms  

Detailed Percentile spectrum:  
Value   Percentile   TotalCount 1/(1-Percentile)  

       0.066     0.000000            1         1.00
       0.585     0.100000       220191         1.11
       0.803     0.200000       439968         1.25
       0.998     0.300000       659099         1.43
       1.195     0.400000       878932         1.67
       1.403     0.500000      1098132         2.00
       1.515     0.550000      1207976         2.22
       1.634     0.600000      1318032         2.50
       1.761     0.650000      1427863         2.86
       1.898     0.700000      1537235         3.33
       2.061     0.750000      1647562         4.00
       2.159     0.775000      1702513         4.44
       2.275     0.800000      1757582         5.00
       2.417     0.825000      1811896         5.71
       2.617     0.850000      1866896         6.67
       2.953     0.875000      1921539         8.00
       3.245     0.887500      1948935         8.89
       3.657     0.900000      1976408        10.00
       4.227     0.912500      2003960        11.43
       4.943     0.925000      2031309        13.33
       5.803     0.937500      2058740        16.00
       6.287     0.943750      2072501        17.78
       6.819     0.950000      2086231        20.00
       7.407     0.956250      2099952        22.86
       8.067     0.962500      2113661        26.67
       8.839     0.968750      2127435        32.00
       9.287     0.971875      2134330        35.56
       9.783     0.975000      2141131        40.00
      10.335     0.978125      2147944        45.71
      10.991     0.981250      2154845        53.33
      11.791     0.984375      2161703        64.00
      12.263     0.985938      2165105        71.11
      12.815     0.987500      2168560        80.00
      13.495     0.989062      2171964        91.43
      14.335     0.990625      2175409       106.67
      15.535     0.992188      2178821       128.00
      16.383     0.992969      2180534       142.22
      17.519     0.993750      2182268       160.00
      19.167     0.994531      2183973       182.86
      21.951     0.995313      2185682       213.33
      27.359     0.996094      2187400       256.00
      30.879     0.996484      2188255       284.44
      34.655     0.996875      2189121       320.00
      38.591     0.997266      2189971       365.71
      42.143     0.997656      2190831       426.67
      45.535     0.998047      2191684       512.00
      47.551     0.998242      2192113       568.89
      50.015     0.998437      2192547       640.00
      53.503     0.998633      2192974       731.43
      58.079     0.998828      2193404       853.33
      62.559     0.999023      2193829      1024.00
      64.671     0.999121      2194043      1137.78
      66.879     0.999219      2194265      1280.00
      68.799     0.999316      2194474      1462.86
      70.911     0.999414      2194691      1706.67
      73.151     0.999512      2194903      2048.00
      74.495     0.999561      2195009      2275.56
      76.223     0.999609      2195117      2560.00
      78.207     0.999658      2195227      2925.71
      80.255     0.999707      2195330      3413.33
      82.623     0.999756      2195439      4096.00
      83.583     0.999780      2195492      4551.11
      84.799     0.999805      2195547      5120.00
      86.271     0.999829      2195598      5851.43
      87.935     0.999854      2195654      6826.67
      89.663     0.999878      2195705      8192.00
      90.687     0.999890      2195732      9102.22
      91.583     0.999902      2195759     10240.00
      92.863     0.999915      2195786     11702.86
      93.951     0.999927      2195817     13653.33
      95.039     0.999939      2195839     16384.00
      95.679     0.999945      2195856     18204.44
      96.319     0.999951      2195866     20480.00
      97.087     0.999957      2195880     23405.71
      97.983     0.999963      2195893     27306.67
      98.687     0.999969      2195907     32768.00
      99.071     0.999973      2195913     36408.89
      99.839     0.999976      2195921     40960.00
     100.479     0.999979      2195929     46811.43
     100.607     0.999982      2195934     54613.33
     101.375     0.999985      2195940     65536.00
     101.631     0.999986      2195943     72817.78
     102.271     0.999988      2195947     81920.00
     102.591     0.999989      2195950     93622.86
     102.911     0.999991      2195953    109226.67
     103.743     0.999992      2195958    131072.00
     103.743     0.999993      2195958    145635.56
     103.935     0.999994      2195961    163840.00
     104.191     0.999995      2195962    187245.71
     104.447     0.999995      2195963    218453.33
     105.727     0.999996      2195965    262144.00
     105.791     0.999997      2195966    291271.11
     106.047     0.999997      2195967    327680.00
     106.175     0.999997      2195968    374491.43
     106.175     0.999998      2195968    436906.67
     106.559     0.999998      2195969    524288.00
     107.967     0.999998      2195971    582542.22
     107.967     0.999998      2195971    655360.00
     107.967     0.999999      2195971    748982.86
     107.967     0.999999      2195971    873813.33
     107.967     0.999999      2195971   1048576.00
     108.479     0.999999      2195973   1165084.44
     108.479     1.000000      2195973          inf
[Mean    =        2.181, StdDeviation   =        3.931]  
[Max     =      108.416, Total count    =      2195973]  
[Buckets =           27, SubBuckets     =         2048]  
----------------------------------------------------------
2398058 requests in 2.00m, 216.05MB read  
Requests/sec:  19983.89  
Transfer/sec:      1.80MB  


# ВЫВОДЫ:

Выдержали нагрузку put'ов и get'ов, хотя get чуть-чуть да просел.  

При использовании hash функции murmur3: Была выбрана сначала эта функция, т.к прочитав про не криптографические хэш функции
она является одной из самых быстрых и дает равномерное распределение хэшей.  

Node(0) - root@DESKTOP-E01FUOQ:~/async-profiler# ls /tmp/highload-dht3917017732371295881  
SSTABLE_0  SSTABLE_0.index  SSTABLE_1  SSTABLE_1.index  SSTABLE_2  SSTABLE_2.index  SSTABLE_3  SSTABLE_3.index  SSTABLE_4  SSTABLE_4.index  SSTABLE_5  SSTABLE_5.index  
Node(1) - root@DESKTOP-E01FUOQ:~/async-profiler# ls /tmp/highload-dht7146053678391197994  
SSTABLE_0        SSTABLE_10.index  SSTABLE_13        SSTABLE_15.index  SSTABLE_18        SSTABLE_2.index   SSTABLE_4        SSTABLE_6.index  SSTABLE_9  
SSTABLE_0.index  SSTABLE_11        SSTABLE_13.index  SSTABLE_16        SSTABLE_18.index  SSTABLE_20        SSTABLE_4.index  SSTABLE_7        SSTABLE_9.index  
SSTABLE_1        SSTABLE_11.index  SSTABLE_14        SSTABLE_16.index  SSTABLE_19        SSTABLE_20.index  SSTABLE_5        SSTABLE_7.index  
SSTABLE_1.index  SSTABLE_12        SSTABLE_14.index  SSTABLE_17        SSTABLE_19.index  SSTABLE_3         SSTABLE_5.index  SSTABLE_8  
SSTABLE_10       SSTABLE_12.index  SSTABLE_15        SSTABLE_17.index  SSTABLE_2         SSTABLE_3.index   SSTABLE_6        SSTABLE_8.index  
Node(2) - root@DESKTOP-E01FUOQ:~/async-profiler# ls /tmp/highload-dht18153132625664245271  
SSTABLE_0        SSTABLE_10        SSTABLE_12        SSTABLE_14        SSTABLE_16        SSTABLE_3        SSTABLE_5        SSTABLE_7        SSTABLE_9  
SSTABLE_0.index  SSTABLE_10.index  SSTABLE_12.index  SSTABLE_14.index  SSTABLE_16.index  SSTABLE_3.index  SSTABLE_5.index  SSTABLE_7.index  SSTABLE_9.index  
SSTABLE_1        SSTABLE_11        SSTABLE_13        SSTABLE_15        SSTABLE_2         SSTABLE_4        SSTABLE_6        SSTABLE_8  
SSTABLE_1.index  SSTABLE_11.index  SSTABLE_13.index  SSTABLE_15.index  SSTABLE_2.index   SSTABLE_4.index  SSTABLE_6.index  SSTABLE_8.index

Locks: 
Локи, как и предыдущем этапе, возникают из-за очереди, которая использутеся в threadPoolExecutor'е.

Cpu's:
Put - Половина всего времени выполнения происходит в методе handleRequest, который обрабатывается в другом потоке
Первая половина от этой половины занимает отправление Response, который все так, как и в прошлых stage'ах занимает не мало
времени(решением может быть смена протокола)
вторая половина - отправление запроса на другую ноду
Get - Практически такое же, что и put'e(отправка response и отправление запрос на другую ноду). Так же тут присутствует, как и во всех
других этапах хождение по диску. Но по сравнению с прошлыми этапами, тут видно, что меньше всяких итераторов, т.к у нас
теперь ключи хранятся на определенных нодах, зависит от хеша, теперь надо меньше этих итераторов, т.к сами данные распределены на других нодах.


Allocs:
Put - По сравнению с прошлым этапов, появилось много алокаций массивов байт в методе invoke. То же самое и для get'a.
Get -


## Put:
[cpu_put](hw4cpu_put.html)
[alloc_put](hw4alloc_put.html)
[lock_put](hw4lock_put.html)


## Get:
[cpu_get](hw4cpu_get.html)
[alloc_get](hw4alloc_get.html)
[lock_get](hw4lock_get.html)

______
