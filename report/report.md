./profiler.sh -d 90 -e lock -f hw3lock_put.html 712  
./profiler.sh -d 90 -e alloc -f hw3alloc_put.html 712  
./profiler.sh -d 90 -f hw3cpu_put.html 712

wrk -c 64 -t 3 -d 1m -R 10000 -L -s get.lua http://localhost:8080

root@DESKTOP-E01FUOQ:~/wrk2# wrk -c 120 -t 3 -d 2m -R 20000 -L -s put.lua http://localhost:8080  
Running 2m test @ http://localhost:8080  
3 threads and 120 connections  
Thread calibration: mean lat.: 4.119ms, rate sampling interval: 11ms  
Thread calibration: mean lat.: 4.320ms, rate sampling interval: 11ms  
Thread calibration: mean lat.: 4.386ms, rate sampling interval: 12ms  
Thread Stats   Avg      Stdev     Max   +/- Stdev  
Latency     1.78ms    1.93ms  33.06ms   91.98%  
Req/Sec     7.00k     1.20k   24.73k    86.95%  
Latency Distribution (HdrHistogram - Recorded Latency)  
50.000%    1.30ms  
75.000%    1.89ms  
90.000%    3.13ms  
99.000%   10.64ms  
99.900%   18.74ms  
99.990%   26.62ms  
99.999%   31.10ms  
100.000%   33.09ms

Detailed Percentile spectrum:  
Value   Percentile   TotalCount 1/(1-Percentile)

       0.053     0.000000            1         1.00
       0.546     0.100000       220053         1.11
       0.746     0.200000       439647         1.25
       0.930     0.300000       659217         1.43
       1.116     0.400000       879074         1.67
       1.303     0.500000      1098512         2.00
       1.402     0.550000      1207826         2.22
       1.507     0.600000      1317647         2.50
       1.619     0.650000      1427790         2.86
       1.742     0.700000      1537597         3.33
       1.889     0.750000      1647192         4.00
       1.983     0.775000      1702412         4.44
       2.095     0.800000      1757046         5.00
       2.231     0.825000      1812027         5.71
       2.417     0.850000      1866945         6.67
       2.685     0.875000      1921613         8.00
       2.875     0.887500      1948959         8.89
       3.129     0.900000      1976403        10.00
       3.467     0.912500      2003861        11.43
       3.907     0.925000      2031407        13.33
       4.471     0.937500      2058772        16.00
       4.803     0.943750      2072626        17.78
       5.179     0.950000      2086335        20.00
       5.607     0.956250      2100024        22.86
       6.099     0.962500      2113680        26.67
       6.687     0.968750      2127396        32.00
       7.027     0.971875      2134240        35.56
       7.443     0.975000      2141121        40.00
       7.903     0.978125      2147977        45.71
       8.439     0.981250      2154878        53.33
       9.087     0.984375      2161747        64.00
       9.455     0.985938      2165166        71.11
       9.863     0.987500      2168608        80.00
      10.327     0.989062      2171989        91.43
      10.871     0.990625      2175450       106.67
      11.487     0.992188      2178863       128.00
      11.847     0.992969      2180577       142.22
      12.247     0.993750      2182276       160.00
      12.711     0.994531      2184013       182.86
      13.247     0.995313      2185709       213.33
      13.879     0.996094      2187436       256.00
      14.263     0.996484      2188300       284.44
      14.687     0.996875      2189143       320.00
      15.135     0.997266      2190003       365.71
      15.679     0.997656      2190855       426.67
      16.319     0.998047      2191711       512.00
      16.719     0.998242      2192158       568.89
      17.119     0.998437      2192584       640.00
      17.615     0.998633      2193002       731.43
      18.175     0.998828      2193429       853.33
      18.847     0.999023      2193863      1024.00
      19.231     0.999121      2194071      1137.78
      19.695     0.999219      2194288      1280.00
      20.143     0.999316      2194503      1462.86
      20.719     0.999414      2194715      1706.67
      21.455     0.999512      2194934      2048.00
      21.839     0.999561      2195037      2275.56
      22.303     0.999609      2195146      2560.00
      22.655     0.999658      2195251      2925.71
      23.199     0.999707      2195359      3413.33
      23.919     0.999756      2195465      4096.00
      24.223     0.999780      2195518      4551.11
      24.719     0.999805      2195573      5120.00
      25.151     0.999829      2195625      5851.43
      25.551     0.999854      2195679      6826.67
      26.031     0.999878      2195732      8192.00
      26.335     0.999890      2195760      9102.22
      26.687     0.999902      2195786     10240.00
      27.039     0.999915      2195813     11702.86
      27.423     0.999927      2195840     13653.33
      27.839     0.999939      2195868     16384.00
      28.207     0.999945      2195881     18204.44
      28.415     0.999951      2195893     20480.00
      28.767     0.999957      2195907     23405.71
      29.023     0.999963      2195920     27306.67
      29.503     0.999969      2195933     32768.00
      29.823     0.999973      2195941     36408.89
      29.999     0.999976      2195947     40960.00
      30.207     0.999979      2195954     46811.43
      30.447     0.999982      2195961     54613.33
      30.719     0.999985      2195967     65536.00
      30.863     0.999986      2195970     72817.78
      30.943     0.999988      2195975     81920.00
      31.007     0.999989      2195977     93622.86
      31.247     0.999991      2195981    109226.67
      31.327     0.999992      2195985    131072.00
      31.327     0.999993      2195985    145635.56
      31.423     0.999994      2195987    163840.00
      31.551     0.999995      2195989    187245.71
      31.615     0.999995      2195990    218453.33
      31.759     0.999996      2195992    262144.00
      32.191     0.999997      2195993    291271.11
      32.399     0.999997      2195994    327680.00
      32.431     0.999997      2195996    374491.43
      32.431     0.999998      2195996    436906.67
      32.431     0.999998      2195996    524288.00
      32.895     0.999998      2195998    582542.22
      32.895     0.999998      2195998    655360.00
      32.895     0.999999      2195998    748982.86
      32.895     0.999999      2195998    873813.33
      32.895     0.999999      2195998   1048576.00
      32.959     0.999999      2195999   1165084.44
      32.959     0.999999      2195999   1310720.00
      32.959     0.999999      2195999   1497965.71
      32.959     0.999999      2195999   1747626.67
      32.959     1.000000      2195999   2097152.00
      33.087     1.000000      2196000   2330168.89
      33.087     1.000000      2196000          inf
[Mean    =        1.779, StdDeviation   =        1.929]  
[Max     =       33.056, Total count    =      2196000]  
[Buckets =           27, SubBuckets     =         2048]
----------------------------------------------------------
2398097 requests in 2.00m, 153.23MB read  
Requests/sec:  19984.04  
Transfer/sec:      1.28MB

----


./profiler.sh -d 90 -e lock -f hw3lock_get.html 712  
./profiler.sh -d 90 -e alloc -f hw3alloc_get.html 712  
./profiler.sh -d 90 -f hw3cpu_get.html 712

# GET

По наполненной базе

root@DESKTOP-E01FUOQ:~/wrk2# wrk -c 120 -t 3 -d 2m -R 20000 -L -s get.lua http://localhost:8080  
Running 2m test @ http://localhost:8080  
3 threads and 120 connections  
Thread calibration: mean lat.: 4.528ms, rate sampling interval: 27ms  
Thread calibration: mean lat.: 4.432ms, rate sampling interval: 27ms  
Thread calibration: mean lat.: 4.903ms, rate sampling interval: 29ms  
Thread Stats   Avg      Stdev     Max   +/- Stdev  
Latency     5.02ms    6.06ms  58.82ms   83.63%  
Req/Sec     6.79k     1.63k   14.43k    72.37%  
Latency Distribution (HdrHistogram - Recorded Latency)  
50.000%    2.03ms  
75.000%    6.90ms  
90.000%   14.69ms  
99.000%   25.01ms  
99.900%   33.60ms  
99.990%   43.74ms  
99.999%   52.80ms  
100.000%   58.85ms

Detailed Percentile spectrum:  
Value   Percentile   TotalCount 1/(1-Percentile)

       0.066     0.000000            1         1.00
       0.711     0.100000       219980         1.11
       1.028     0.200000       439383         1.25
       1.322     0.300000       658797         1.43
       1.652     0.400000       878618         1.67
       2.032     0.500000      1097942         2.00
       2.283     0.550000      1208125         2.22
       2.707     0.600000      1317549         2.50
       3.549     0.650000      1427378         2.86
       4.947     0.700000      1537185         3.33
       6.903     0.750000      1646939         4.00
       8.019     0.775000      1701847         4.44
       9.223     0.800000      1756640         5.00
      10.487     0.825000      1811726         5.71
      11.823     0.850000      1866567         6.67
      13.215     0.875000      1921540         8.00
      13.927     0.887500      1948791         8.89
      14.695     0.900000      1976391        10.00
      15.519     0.912500      2003696        11.43
      16.399     0.925000      2031147        13.33
      17.391     0.937500      2058587        16.00
      17.919     0.943750      2072485        17.78
      18.495     0.950000      2086192        20.00
      19.119     0.956250      2100080        22.86
      19.791     0.962500      2113451        26.67
      20.591     0.968750      2127343        32.00
      21.039     0.971875      2134203        35.56
      21.535     0.975000      2140918        40.00
      22.063     0.978125      2147770        45.71
      22.671     0.981250      2154652        53.33
      23.375     0.984375      2161514        64.00
      23.759     0.985938      2165004        71.11
      24.159     0.987500      2168348        80.00
      24.655     0.989062      2171843        91.43
      25.247     0.990625      2175268       106.67
      25.919     0.992188      2178635       128.00
      26.319     0.992969      2180401       142.22
      26.751     0.993750      2182089       160.00
      27.263     0.994531      2183828       182.86
      27.791     0.995313      2185508       213.33
      28.431     0.996094      2187222       256.00
      28.799     0.996484      2188086       284.44
      29.247     0.996875      2188924       320.00
      29.759     0.997266      2189804       365.71
      30.351     0.997656      2190653       426.67
      31.039     0.998047      2191504       512.00
      31.487     0.998242      2191937       568.89
      31.967     0.998437      2192362       640.00
      32.511     0.998633      2192789       731.43
      33.087     0.998828      2193241       853.33
      33.695     0.999023      2193647      1024.00
      34.111     0.999121      2193857      1137.78
      34.623     0.999219      2194075      1280.00
      35.199     0.999316      2194294      1462.86
      35.871     0.999414      2194501      1706.67
      36.575     0.999512      2194722      2048.00
      37.151     0.999561      2194821      2275.56
      37.663     0.999609      2194928      2560.00
      38.431     0.999658      2195037      2925.71
      39.039     0.999707      2195145      3413.33
      39.743     0.999756      2195251      4096.00
      40.191     0.999780      2195305      4551.11
      40.735     0.999805      2195358      5120.00
      41.279     0.999829      2195411      5851.43
      42.015     0.999854      2195466      6826.67
      42.879     0.999878      2195518      8192.00
      43.391     0.999890      2195544      9102.22
      43.839     0.999902      2195572     10240.00
      44.383     0.999915      2195600     11702.86
      44.927     0.999927      2195625     13653.33
      45.503     0.999939      2195651     16384.00
      45.919     0.999945      2195665     18204.44
      46.367     0.999951      2195679     20480.00
      47.007     0.999957      2195692     23405.71
      47.935     0.999963      2195705     27306.67
      48.671     0.999969      2195719     32768.00
      48.959     0.999973      2195725     36408.89
      49.567     0.999976      2195732     40960.00
      49.855     0.999979      2195739     46811.43
      50.687     0.999982      2195745     54613.33
      51.551     0.999985      2195753     65536.00
      51.775     0.999986      2195756     72817.78
      51.967     0.999988      2195759     81920.00
      52.287     0.999989      2195762     93622.86
      52.959     0.999991      2195765    109226.67
      53.663     0.999992      2195769    131072.00
      53.855     0.999993      2195770    145635.56
      54.271     0.999994      2195772    163840.00
      54.975     0.999995      2195774    187245.71
      55.455     0.999995      2195775    218453.33
      56.127     0.999996      2195777    262144.00
      56.671     0.999997      2195778    291271.11
      56.863     0.999997      2195779    327680.00
      56.959     0.999997      2195780    374491.43
      56.959     0.999998      2195780    436906.67
      57.183     0.999998      2195781    524288.00
      57.823     0.999998      2195782    582542.22
      57.823     0.999998      2195782    655360.00
      57.919     0.999999      2195783    748982.86
      57.919     0.999999      2195783    873813.33
      57.919     0.999999      2195783   1048576.00
      58.271     0.999999      2195784   1165084.44
      58.271     0.999999      2195784   1310720.00
      58.271     0.999999      2195784   1497965.71
      58.271     0.999999      2195784   1747626.67
      58.271     1.000000      2195784   2097152.00
      58.847     1.000000      2195785   2330168.89
      58.847     1.000000      2195785          inf
[Mean    =        5.017, StdDeviation   =        6.062]  
[Max     =       58.816, Total count    =      2195785]  
[Buckets =           27, SubBuckets     =         2048]
----------------------------------------------------------
2391862 requests in 2.00m, 168.45MB read  
Requests/sec:  19931.77  
Transfer/sec:      1.40MB

# ВЫВОДЫ:

После вынесения обработки запросов, уменьшилась максимальная задержка как при put'e, так и при get'e. Теперь есть общая
очередь для запросов, которую обрабатывает executor, если очередь заполнилась, то выдается ответ, что сервис Unavailable.

Locks: И при put'e и при get'e можно заметить, что есть lock на sendResponse, это 90%, это по идее нормальнаяя ситуация,
т.к сам метод под synchronized, и когда какой-либо поток входит, что блокируется выполнение. Этого, вроде, никак не
избежать. Ну и так же есть локи при работе с очередью, т.к используется BlockingLinkedQueue.

Cpu's:
В put'e видно, что вся обработка вынесена в потоки, в основном потоке осталось 12% добавление задачи в очередь.
В get'e видно, что 70% работы выполняется в других потоках, и все так же в основном есть добавление в очередь задач.

Allocs:
По аллокациям ситуация похожа, все по 20% всей памяти аллоцируется в других потока, в основном же есть аллокации,
когда получаем path, key, ну и добавление в очередь.

Есть сомнение на счет while(true), до этого вставлял очередь, в которую сейчас кладу задачи, в сам executor. Разницы
особо нет. Показывает практически одинаковые значения.

[cpu_put](hw3cpu_put.html)  
[alloc_put](hw3alloc_put.html)  
[lock_put](hw3lock_put.html)  

## Put:

[cpu_get](hw3cpu_get.html)  
[alloc_get](hw3alloc_get.html)  
[lock_get](hw3lock_get.html)  

## Get:

